name: "macOS builds"
on: push
jobs:
  xcode_ports:
    name: Xcode & MacPorts
    runs-on: macOS-10.14
    steps:
      - uses: actions/checkout@v1
      - run: |
          xcode-select --install || true
          sudo xcodebuild -license || true
          ls /usr/bin/gcc*
          /usr/bin/gcc -v
          echo $PWD
          mkdir ports
          cd ports
          git clone --depth=1 https://github.com/macports/macports-base.git src
          cd src
          ./configure --prefix="$(dirname "$PWD")"
          make -j"$(sysctl -n hw.physicalcpu || echo 4)"
          make install || true
          cd ..
          PATH="${PWD}/sbin:${PWD}/bin:${PATH"
          echo '-listing ${PWD} -'
          ls
          echo '---'
          ls bin*/
          echo '-selfupdate-'
          port selfupdate || true
          echo '-installing deps-'
          echo coreutils autogen automake autoconf pkgconfig libpng libsdl libsdl_net opusfile speexDSP | xargs -n1 port install || true
          echo '-listing bin*/ -'
          ls bin*/
          echo '-listing lib*/ -'
          ls lib*/
          echo '-installing gcc9-'
          port install gcc9 || true          

