name: "macOS builds"
on: push
jobs:
  xcode_ports:
    name: Xcode & MacPorts
    runs-on: macOS-10.14
    steps:
      - uses: actions/checkout@v1
      - run: |
          set +e
          xcode-select --install
          sudo xcodebuild -license
          ls /usr/bin/gcc*
          /usr/bin/gcc -v
          echo $PWD
          mkdir ports
          cd ports
          git clone --depth=1 https://github.com/macports/macports-base.git src
          cd src
          ./configure --prefix="$(dirname "$PWD")"
          make -j"$(sysctl -n hw.physicalcpu || echo 4)"
          sudo make install
          cd ..
          PATH="${PWD}/sbin:${PWD}/bin:${PATH"
          echo '-listing ${PWD} -'
          ls
          echo '---'
          ls bin*/
          echo '-selfupdate-'
          sudo port -q selfupdate
          echo '-installing deps-'
          sudo port -q install libsdl +x11
          sudo port -q install coreutils autogen automake autoconf pkgconfig libpng libsdl_net opusfile speexDSP
          echo '-listing bin*/ -'
          ls bin*/
          echo '-listing lib*/ -'
          ls lib*/
          echo '-installing gcc9-'
          sudo port -q install gcc9
          automake --version
          pkg-config --version
          gcc -v
          gcc-9 -v

