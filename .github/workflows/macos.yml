name: "macOS builds"
on: push
jobs:
  xcode_ports:
    name: Xcode & MacPorts
    runs-on: macOS-10.14
    steps:
      - uses: actions/checkout@v1
      - run: |
          set +e
          xcode-select --install || true
          sudo xcodebuild -license || true
          ls /usr/bin/gcc* || true
          /usr/bin/gcc -v
          echo $PWD
          mkdir ports
          cd ports
          git clone --quiet --depth=1 https://github.com/macports/macports-base.git src
          cd src
          ./configure --prefix="$(dirname "$PWD")" &> log || cat log
          make -j"$(sysctl -n hw.physicalcpu || echo 4)" &> log || cat log
          sudo make install || true
          cd ..
          PATH="${PWD}/sbin:${PWD}/bin:${PATH}"
          echo '-listing ${PWD} -'
          ls
          echo '---'
          ls bin*/
          echo '-selfupdate-'
          sudo port -q selfupdate || true
          echo '-installing deps-'
          sudo port -q install libsdl +x11 || true
          sudo port -q install coreutils autogen automake autoconf pkgconfig libpng libsdl_net opusfile speexDSP || true
          echo '-listing bin*/ -'
          ls bin*/
          echo '-listing lib*/ -'
          ls lib*/
          echo '-installing gcc9-'
          sudo port -q install gcc9 || true
          automake --version
          pkg-config --version
          gcc -v
          gcc-9 -v

